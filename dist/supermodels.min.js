!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.supermodels=e()}}(function(){var e,t,r;return function e(t,r,n){function i(s,o){if(!r[s]){if(!t[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'")}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return i(r?r:e)},f,f.exports,e,t,r,n)}return r[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){var n=e("./lib/def");var i=e("./lib/proto");var a=e("./lib/supermodel");function s(e,t,r){var i=n(e);function s(){var e=i.isSimple?i.create(r):i.create(r).value;if(t){t.apply(e,arguments)}return e}Object.defineProperty(s,"def",{value:i});s.prototype=a;s.constructor=s;return s}t.exports=s},{"./lib/def":2,"./lib/proto":5,"./lib/supermodel":6}],2:[function(e,t,r){var n=e("./util");var i=e("./factory");function a(e){var t=n.isConstructor(e);var r=n.isSupermodelConstructor(e);var i=n.isArray(e);if(t||r||i){return{__type:e}}var a=!n.isObject(e);if(a){return{__value:e}}return e}function s(e){e=a(e);var t="__validators",r="__value",o="__type",u="__displayName",f="__get",l="__set",c="__enumerable",p="__configurable",v="__writable",h=[t,r,o,u,f,l,c,p,v];var _={from:e,type:e[o],value:e[r],validators:e[t]||[],enumerable:e[c]===false?false:true,configurable:e[p]?true:false,writable:e[v]===false?false:true,displayName:e[u],getter:e[f],setter:e[l]};var d=_.type;if(n.isSimpleConstructor(d)){_.isSimple=true;_.cast=function(e){return n.cast(e,d)}}else if(n.isSupermodelConstructor(d)){_.isReference=true}else if(_.value){_.isSimple=true}else{var y=Object.keys(e);var m=y.filter(function(e){return h.indexOf(e)===-1});if(m.length){var g={};var b;m.forEach(function(t){var r=e[t];if(!n.isConstructor(r)&&!n.isSupermodelConstructor(r)&&n.isFunction(r)){if(!b){b={}}b[t]=r}else{g[t]=s(r)}});_.defs=g;_.proto=b}if(d===Array||n.isArray(d)){_.isArray=true;if(d.length>0){_.def=s(d[0])}}}_.create=i(_);return _}t.exports=s},{"./factory":3,"./util":7}],3:[function(e,t,r){var n=e("./util");var i=e("./proto");var a=e("./wrapper");function s(e,t){var r={};var n={__:{value:r},__def:{value:e},__parent:{value:t,writable:true}};return n}function o(e){var t=e.__def.defs;for(var r in t){u(e,r,t[r])}}function u(e,t,r){var n={get:function(){return this.__get(t)},enumerable:r.enumerable,configurable:r.configurable};if(r.writable){n.set=function(e){this.__setNotifyChange(t,e)}}Object.defineProperty(e,t,n);e.__[t]=r.create(e)}function f(e){var t,r,u;if(e.isSimple){t=new a(e.value,e.writable,e.validators,e.cast,null)}else if(e.isReference){var f=e.type.def;if(f.isSimple){t=new a(f.value,f.writable,f.validators,f.cast,null)}else{u=function(e){var t=false;if(n.isNullOrUndefined(e)){t=true}else{t=f===e.__def}if(!t){throw new Error("Value should be an instance of the referenced model, null or undefined")}};t=new a(e.value,e.writable,e.validators,null,u)}}else if(e.isArray){r=function(t){var r=i(e);Object.defineProperties(r,s(e,t));o(r);return r};u=function(e){if(!n.isArray(e)){throw new Error("Value should be an array")}};t=new a(r,e.writable,e.validators,null,u)}else{var l=i(e);r=function(t){var r=Object.create(l,s(e,t));o(r);return r};u=function(e){if(!l.isPrototypeOf(e)){throw new Error("Invalid prototype")}};t=new a(r,e.writable,e.validators,null,u)}var c=function(e){var r=Object.create(t);if(!r.isInitialized){r.initialize(e)}return r};c.wrapper=t;return c}t.exports=f},{"./proto":5,"./util":7,"./wrapper":9}],4:[function(e,t,r){var n=e("emitter-event");var i=e("./validation-error");var a=e("./wrapper");var s={__supermodel:{value:true},__keys:{get:function(){var e=Object.keys(this);if(Array.isArray(this)){var t=["addEventListener","on","once","removeEventListener","removeAllListeners","removeListener","off","emit","listeners","hasListeners","pop","push","reverse","shift","sort","splice","update","unshift","create","__setNotifyChange","__notifyChange","__set","__get"];e=e.filter(function(e){return t.indexOf(e)<0})}return e}},__name:{get:function(){if(this.__isRoot){return""}var e=this.__parent.__keys;var t,r,n;for(var i=0;i<e.length;i++){t=e[i];r=this.__parent[t];n=Array.isArray(r);if(r===this){return t}}}},__path:{get:function(){if(this.__hasAncestors&&!this.__parent.__isRoot){return this.__parent.__path+"."+this.__name}else{return this.__name}}},__isRoot:{get:function(){return!this.__hasAncestors}},__children:{get:function(){var e=[];var t=this.__keys;var r,n;for(var i=0;i<t.length;i++){r=t[i];n=this[r];if(n&&n.__supermodel){e.push(n)}}return e}},__ancestors:{get:function(){var e=[],t=this;while(t.__parent){e.push(t.__parent);t=t.__parent}return e}},__descendants:{get:function(){var e=[];function t(r){var n=r.__keys;var i,a;for(var s=0;s<n.length;s++){i=n[s];a=r[i];if(a&&a.__supermodel){e.push(a);t(a)}}}t(this);return e}},__hasAncestors:{get:function(){return!!this.__ancestors.length}},__hasDecendants:{get:function(){return!!this.__descendants.length}},errors:{get:function(){var e=[],t=this.__def;var r,n,s,o;var u=t.validators.slice(0);for(s=0;s<u.length;s++){r=u[s];n=r.call(this,this);if(n){e.push(new i(this,n,r))}}var f=this.__keys;var l,c,p;for(s=0;s<f.length;s++){c=f[s];if(t.isArray&&t.def&&!(c in t.defs)){p=t.def;if(p.isSimple){l=p.create.wrapper;l.value=this[c]}else if(p.isReference&&p.type.def.isSimple){l=p.type.def.create.wrapper;l.value=this[c]}else{l=this[c]}}else{l=this.__[c]}if(l){if(l.__supermodel){Array.prototype.push.apply(e,l.errors)}else if(l instanceof a){var v=l.value;if(!l._assert){var h=l.validators;for(o=0;o<h.length;o++){r=h[o];n=r.call(this,v,c);if(n){e.push(new i(this,n,r,c))}}}else if(v&&v.__supermodel){Array.prototype.push.apply(e,v.errors)}else{throw"just checking"}}}}return e}}};var o={__get:function(e){return this.__[e].value},__set:function(e,t){if(t&&t.__supermodel){if(t.__parent!==this){t.__parent=this}}this.__[e].value=t},__notifyChange:function(e,t,r){this.emit("change",new n("change",this,{name:e,value:t,oldValue:r}));this.emit("change:"+e,new n("change:"+e,this,{value:t,oldValue:r}));var i;for(var a=0;a<this.__ancestors.length;a++){i=this.__path+"."+e;this.__ancestors[a].emit("change",new n("change",this,{name:i,value:t,oldValue:r}));this.__ancestors[a].emit("change:"+i,new n("change:"+i,this,{name:i,value:t,oldValue:r}))}},__setNotifyChange:function(e,t){var r=this.__get(e);this.__set(e,t);var n=this.__get(e);this.__notifyChange(e,n,r)}};t.exports={proto:o,descriptors:s}},{"./validation-error":8,"./wrapper":9,"emitter-event":13}],5:[function(e,t,r){var n=e("emitter-object");var i=e("emitter-array");var a=e("./util").extend;var s=e("./model").proto;var o=e("./model").descriptors;var u=Object.create(s,o);var f=function(){var e=Object.create(u);n(e);return e}();function l(){var e=i(function(){});Object.defineProperties(e,o);n(e);a(e,s);return e}function c(e){if(e){return Object.create(a(e,f))}else{return Object.create(f)}}function p(e,t){var r=l();if(e){a(r,e)}if(t){var n=t.create.wrapper;h(r,n);if(!t.isSimple&&!t.isReference){r.create=function(){return t.create(this).value}}}return r}function v(e,t){var r=[];for(var n=0;n<t.length;n++){e.value=t[n];r.push(e.value)}return r}function h(e,t){var r=e.push;var n=e.unshift;var i=e.splice;if(r){e.push=function(){var n=v(t,arguments);return r.apply(e,n)}}if(n){e.unshift=function(){var r=v(t,arguments);return n.apply(e,r)}}if(i){e.splice=function(){var r=v(t,Array.prototype.slice.call(arguments,2));r.unshift(arguments[1]);r.unshift(arguments[0]);return i.apply(e,r)}}}function _(e){return e.isArray?p(e.proto,e.def):c(e.proto)}t.exports=_},{"./model":4,"./util":7,"emitter-array":10,"emitter-object":14}],6:[function(e,t,r){t.exports={}},{}],7:[function(e,t,r){var n=e("./supermodel");function i(e,t){if(!t||typeof t!=="object"){return e}var r=Object.keys(t);var n=r.length;while(n--){e[r[n]]=t[r[n]]}return e}var a={extend:i,typeOf:function(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},isObject:function(e){return this.typeOf(e)==="object"},isArray:function(e){return Array.isArray(e)},isSimple:function(e){return!this.isObject(e)&&!this.isArray(e)},isFunction:function(e){return this.typeOf(e)==="function"},isDate:function(e){return this.typeOf(e)==="date"},isNull:function(e){return e===null},isUndefined:function(e){return typeof e==="undefined"},isNullOrUndefined:function(e){return this.isNull(e)||this.isUndefined(e)},cast:function(e,t){if(!t){return e}switch(t){case String:return a.castString(e);case Number:return a.castNumber(e);case Boolean:return a.castBoolean(e);case Date:return a.castDate(e);case Object:case Function:return e;default:throw new Error("Invalid cast")}},castString:function(e){if(e===undefined||e===null||a.typeOf(e)==="string"){return e}return e.toString&&e.toString()},castNumber:function(e){if(e===undefined||e===null){return NaN}if(a.typeOf(e)==="number"){return e}return Number(e)},castBoolean:function(e){if(!e){return false}var t=["0","false","off","no"];return t.indexOf(e)===-1},castDate:function(e){if(e===undefined||e===null||a.typeOf(e)==="date"){return e}return new Date(e)},isConstructor:function(e){return this.isSimpleConstructor(e)||[Array,Object].indexOf(e)>-1},isSimpleConstructor:function(e){return[String,Number,Date,Boolean].indexOf(e)>-1},isSupermodelConstructor:function(e){return this.isFunction(e)&&e.prototype===n}};t.exports=a},{"./supermodel":6}],8:[function(e,t,r){function n(e,t,r,n){this.target=e;this.error=t;this.validator=r;if(n){this.key=n}}t.exports=n},{}],9:[function(e,t,r){var n=e("./util");function i(e,t,r,i,a){this.validators=r;this._defaultValue=e;this._writable=t;this._beforeSet=i;this._assert=a;this.isInitialized=false;if(!n.isFunction(e)){this.isInitialized=true;if(!n.isUndefined(e)){this.value=e}}}i.prototype.initialize=function(e){if(this.isInitialized){return}this.value=this._defaultValue(e);this.isInitialized=true};Object.defineProperties(i.prototype,{value:{get:function(){return this._getter?this._getter():this._value},set:function(e){if(!this._writable){throw new Error("Value is readonly")}var t=this._beforeSet?this._beforeSet(e):e;if(this._assert){this._assert(t)}this._value=t}}});t.exports=i},{"./util":7}],10:[function(e,t,r){var n=e("emitter-object");var i=e("emitter-event");function a(e,t,r){var n=new i(e,t,r);t.emit(e,n);t.emit("change",n)}t.exports=function(e){e=e||raiseEvent;var t=arguments;var r=[];if(!e)n(r);var i=function(){var t=Array.prototype.pop.apply(r);e("pop",r,{value:t});return t};var a=function(){var t=Array.prototype.push.apply(r,arguments);e("push",r,{value:t});return t};var s=function(){var t=Array.prototype.reverse.apply(r);e("reverse",r,{value:t});return t};var o=function(){var t=Array.prototype.shift.apply(r);e("shift",r,{value:t});return t};var u=function(){var t=Array.prototype.sort.apply(r,arguments);e("sort",r,{value:t});return t};var f=function(){var t=Array.prototype.unshift.apply(r,arguments);e("unshift",r,{value:t});return t};var l=function(){if(!arguments.length){return}var t=Array.prototype.splice.apply(r,arguments);e("splice",r,{value:t,removed:t,added:Array.prototype.slice.call(arguments,2)});return t};r.pop=r.pop&&i;r.push=r.push&&a;r.reverse=r.reverse&&s;r.shift=r.shift&&o;r.sort=r.sort&&u;r.splice=r.splice&&l;r.update=function(t,n){var i=r[t];var a=r[t]=n;e("update",r,{value:a,oldValue:i});return a};return r}},{"emitter-event":11,"emitter-object":12}],11:[function(e,t,r){t.exports=function e(t,r,n){this.name=t;this.target=r;if(n){this.detail=n}}},{}],12:[function(e,t,r){t.exports=n;function n(e){var t=e||this;var r;Object.defineProperty(t,"__callbacks",{get:function(){return r=r||{}},set:function(e){r=e}});if(e){t=i(e);return t}}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){(this.__callbacks[e]=this.__callbacks[e]||[]).push(t);return this};n.prototype.once=function(e,t){function r(){this.off(e,r);t.apply(this,arguments)}r.fn=t;this.on(e,r);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(0==arguments.length){this.__callbacks={};return this}var r=this.__callbacks[e];if(!r)return this;if(1==arguments.length){delete this.__callbacks[e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){var t=[].slice.call(arguments,1),r=this.__callbacks[e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){return this.__callbacks[e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],13:[function(e,t,r){t.exports=e(11)},{}],14:[function(e,t,r){t.exports=e(12)},{}]},{},[1])(1)});